\@ifundefined{ExplLoaderFileDate}
  {\RequirePackage{expl3}}
  {}
\@ifl@t@r\ExplLoaderFileDate{2022-11-09}
  {}
  {%
    \PackageError{SEcover-v3}{Support package expl3 too old}
      {%
        You need to update your installation of 'l3kernel'.\MessageBreak
        Loading~SEcover-v3~will~abort!%
      }%
    \endinput
  }%
\ProvidesExplPackage {SEcover-v3} {2025-05-31} {2.0.0}
  {A cover style created by SakuraEx}
%<@@=SEcover>
\providecommand \IfFormatAtLeastTF { \@ifl@t@r \fmtversion }
\cs_new:Npn \__SEcover_new_variable:nn #1#2
  {
    \use:c { #1_new:c }
      { l__SEcover_ #2 _#1 }
  }
\cs_new:Npn \__SEcover_new_variable_with_default:nn #1#2
  {
    \use:c { #1_new:c }
      { l__SEcover_default_ #2 _#1 }
    \use:c { #1_new:c }
      { l__SEcover_ #2 _#1 }
  }
\cs_new:Npn \__SEcover_variable_new_from_clist:nnn #1#2#3
  {
    \int_case:nn {#2}
      {
        { 0 } { \clist_map_inline:nn {#3} { \__SEcover_new_variable:nn {#1} {##1} } }
        { 1 } { \clist_map_inline:nn {#3} { \__SEcover_new_variable_with_default:nn {#1} {##1} } }
      }
  }

\__SEcover_variable_new_from_clist:nnn { dim } { 0 }
  {
    cover_width
  }
\__SEcover_variable_new_from_clist:nnn { dim } { 1 }
  {
    label_length,
    label_font_size,
    total_length,
    occupied_length,
    content_font_size,
    line_spacing
  }
\__SEcover_variable_new_from_clist:nnn { tl } { 0 }
  {
    title_font
  }
\__SEcover_variable_new_from_clist:nnn { tl } { 1 }
  {
    label_format,
    content_format
  }
\cs_new:Npn \__SEcover_set_base_format:nnn #1#2#3
  {
    \dim_set:Nn \l__SEcover_default_label_length_dim {#1}
    \tl_set:Nn \l__SEcover_default_label_format_tl {#2}
    \tl_set:Nn \l__SEcover_default_content_format_tl {#3}
  }
\cs_new:Npn \__SEcover_latin_base_format:
  { \__SEcover_set_base_format:nnn { 0pt } { \sf } { \relax } }
\cs_new:Npn \__SEcover_chinese_base_format:
  {
    \@ifpackageloaded { ctex }
      { }
      { \RequirePackage { ctex } }
    \__SEcover_set_base_format:nnn { 56pt } { \sf\heiti } { \kaishu }
  }
\keys_define:nn { SEcover-v3 }
  {
    language .choice:,
    language / en-us .code:n = \__SEcover_latin_base_format:,
    language / zh-cn .code:n = \__SEcover_chinese_base_format:,
    language / zh-hk .code:n = \__SEcover_chinese_base_format:,
    language / zh-tw .code:n = \__SEcover_chinese_base_format:,
    language / unknown .code:n =
      {
        \__SEcover_latin_base_format:
        \msg_warning:nneee { SEcover-v3 } { unknown-language }
        { en-us , zh-cn , zh-hk , zh-tw }
        { \exp_not:n {#1} }
      },
    language .default:n = en-us
  }
\msg_new:nnnn { SEcover-v3 } { unknown-language }
  {
    The~language~#2~is~not~supported.~Use~'en-us'~instead.
  }
  {
    #1
  }
\keys_define:nn { SEcover-v3 }
  {
    cover-width .dim_set:N =
      \l__SEcover_cover_width_dim,
    cover-width .initial:n = { 400 pt },
    label-length .dim_set:N =
      \l__SEcover_default_label_length_dim,
    label-format .tl_set:N =
      \l__SEcover_default_label_format_tl,
    label-font-size .dim_set:N =
      \l__SEcover_default_label_font_size_dim,
    label-font-size .initial:n = { 14 pt },
    total-length .dim_set:N =
      \l__SEcover_default_total_length_dim,
    total-length .initial:n = { 190 pt },
    content-format .tl_set:N =
      \l__SEcover_default_content_format_tl,
    content-font-size .dim_set:N =
      \l__SEcover_default_content_font_size_dim,
    content-font-size .initial:n = { 14 pt },
    line-spacing .dim_set:N =
      \l__SEcover_default_line_spacing_dim,
    line-spacing .initial:n = { 14 pt },
    occupied-length .dim_set:N =
      \l__SEcover_default_occupied_length_dim,
    occupied-length .initial:n = { 190 pt }
  }
\keys_define:nn { SEcover-v3 / local / label }
  {
    length .dim_set:N =
      \l__SEcover_label_length_dim,
    format .tl_set:N =
      \l__SEcover_label_format_tl,
    font-size .dim_set:N =
      \l__SEcover_label_font_size_dim
  }
\keys_define:nn { SEcover-v3 / local / content }
  {
    format .tl_set:N =
      \l__SEcover_content_format_tl,
    font-size .dim_set:N =
      \l__SEcover_content_font_size_dim
  }
\keys_define:nn { SEcover-v3 / local / box }
  {
    total .dim_set:N =
      \l__SEcover_total_length_dim
  }
\keys_define:nn { SEcover-v3 / local / width }
  {
    occupied .dim_set:N =
      \l__SEcover_occupied_length_dim
  }
\cs_new:Npn \__SEcover_reset_local:
  {
    \dim_set_eq:NN \l__SEcover_label_length_dim \l__SEcover_default_label_length_dim
    \dim_set_eq:NN \l__SEcover_label_font_size_dim \l__SEcover_default_label_font_size_dim
    \dim_set_eq:NN \l__SEcover_total_length_dim \l__SEcover_default_total_length_dim
    \dim_set_eq:NN \l__SEcover_occupied_length_dim \l__SEcover_default_occupied_length_dim
    \dim_set_eq:NN \l__SEcover_content_font_size_dim \l__SEcover_default_content_font_size_dim
    \tl_set_eq:NN \l__SEcover_label_format_tl \l__SEcover_default_label_format_tl
    \tl_set_eq:NN \l__SEcover_content_format_tl \l__SEcover_default_content_format_tl
  }
\IfFormatAtLeastTF { 2022-06-01 }
  { \ProcessKeyOptions [ SEcover-v3 ] }
  {
    \RequirePackage { l3keys2e }
    \ProcessKeysOptions { SEcover-v3 }
  }
\IfFormatAtLeastTF { 2020-10-01 }
  { }
  {
    \RequirePackage { xparse }
    \providecommand \ExpandArgs [1]
      { \cs_if_exist_use:c { exp_args:N #1 } }
  }
\seq_new:N \l__SEcover_cover_info_seq
\int_new:N \l__SEcover_box_count_int
\int_set:Nn \l__SEcover_box_count_int { 1 }
\cs_new:Npn \__SEcover_inner_variable:nn #1#2
  { l__SEcover_info_ \int_to_roman:n { \l__SEcover_box_count_int } _#2_#1 }
\cs_new:Npn \__SEcover_info_box:nnnn #1#2#3#4
  {
    \dim_set:Nn \l_tmpb_dim { #4 - #3 }
    \hbox to #4
      {
        \hb@xt@ #3 { \cs:w \__SEcover_inner_variable:nn { tl } { label_format } \cs_end: #1 }
        \rlap { \rule[ -3.3pt ] { \l_tmpb_dim } { 0.4pt } }
        \hb@xt@ \l_tmpb_dim
        { \hss \cs:w \__SEcover_inner_variable:nn { tl } { content_format } \cs_end: #2 \hss }
      }
  }
\cs_generate_variant:Nn \__SEcover_info_box:nnnn { nnvv }
\cs_new_protected:Npn \__SEcover_create_info_box:nn #1#2
  {
    \bool_if:nT
      {
        \dim_compare_p:nNn
          { \cs:w \__SEcover_inner_variable:nn { dim } { occupied_length } \cs_end: }
          >
          { \l__SEcover_cover_width_dim / 2 }
        &&
        \int_compare_p:nNn { \l__SEcover_box_count_int } > { 1 }
      }
      { \newline }
    \hbox_set:Nn \l_tmpa_box
      { \cs:w \__SEcover_inner_variable:nn { tl } { label_format } \cs_end: #1 }
    \dim_set_eq:Nc \l_tmpb_dim { \__SEcover_inner_variable:nn { dim } { label_length } }
    \dim_set:cn { \__SEcover_inner_variable:nn { dim } { label_length } }
      {
        \dim_compare:nNnTF
        { \box_wd:N \l_tmpa_box } < { \l_tmpb_dim }
        { \l_tmpb_dim }
        { \box_wd:N \l_tmpa_box }
      }
      % 测量标签的自然宽度，如果大于设置的 label-length 则直接使用标签的自然宽度作为标签的宽度，否则使用 label-length 作为标签的宽度。
    \hb@xt@ \cs:w \__SEcover_inner_variable:nn { dim } { occupied_length } \cs_end:
      {
        \hss 
        \__SEcover_info_box:nnvv {#1} {#2}
          { \__SEcover_inner_variable:nn { dim } { label_length } }
          { \__SEcover_inner_variable:nn { dim } { total_length } }
        \hss
      }
    \int_incr:N \l__SEcover_box_count_int 
  }
\cs_new:Npn \__SEcover_new_cover_content:nn #1#2
  {
    \dim_new:c { \__SEcover_inner_variable:nn { dim } { total_length } }
    \dim_new:c { \__SEcover_inner_variable:nn { dim } { label_length } }
    \dim_new:c { \__SEcover_inner_variable:nn { dim } { occupied_length } }
    \tl_new:c { \__SEcover_inner_variable:nn { tl } { label_format } }
    \tl_new:c { \__SEcover_inner_variable:nn { tl } { content_format } }
    \dim_set_eq:cN { \__SEcover_inner_variable:nn { dim } { total_length } }
      \l__SEcover_total_length_dim
    \dim_set_eq:cN { \__SEcover_inner_variable:nn { dim } { label_length } }
      \l__SEcover_label_length_dim
    \dim_set_eq:cN { \__SEcover_inner_variable:nn { dim } { occupied_length } }
      \l__SEcover_occupied_length_dim
    \tl_put_left:Ne \l__SEcover_label_format_tl
      {
        \exp_not:N \fontsize
        { \dim_use:N \l__SEcover_label_font_size_dim }
        { \dim_use:N \l__SEcover_default_line_spacing_dim }
        \exp_not:N \selectfont
      }
    \tl_set_eq:cN { \__SEcover_inner_variable:nn { tl } { label_format } }
      \l__SEcover_label_format_tl
    \tl_put_left:Ne \l__SEcover_content_format_tl
      {
        \exp_not:N \fontsize
        { \dim_use:N \l__SEcover_content_font_size_dim }
        { \dim_use:N \l__SEcover_default_line_spacing_dim }
        \exp_not:N  \selectfont
      }
    \tl_set_eq:cN { \__SEcover_inner_variable:nn { tl } { content_format } }
      \l__SEcover_content_format_tl
    \seq_gput_right:Nn \l__SEcover_cover_info_seq
      { \__SEcover_create_info_box:nn {#1} {#2} }
    \int_incr:N \l__SEcover_box_count_int
  }
\NewDocumentCommand \newcovercontent { s O { } m O { } m O { } O { } }
  {
    \__SEcover_reset_local:
    \keys_set:nn { SEcover-v3 / local / label } {#2}
    \keys_set:nn { SEcover-v3 / local / content } {#4}
    \IfBooleanT {#1}
      {
        \keys_set:nn { SEcover-v3 / local / box }
          { total = \l__SEcover_cover_width_dim }
        \keys_set:nn { SEcover-v3 / local / width }
          { occupied = \l__SEcover_cover_width_dim }
      }
    \keys_set:nn { SEcover-v3 / local / box } {#6}
    \keys_set:nn { SEcover-v3 / local / width } {#7}
    \__SEcover_new_cover_content:nn {#3} {#5}
  }
\DeclareDocumentCommand \SEcoverSetup { m }
  {
    \keys_set:nn { SEcover-v3 } { #1 }
    \dim_set:Nn \l__SEcover_default_total_length_dim { \l__SEcover_cover_width_dim / 40 * 19 }
  }
\providecommand \coversep { \seq_gput_right:Nn \l__SEcover_cover_info_seq { \vspace{20pt} } }
\providecommand \makecover {
  \int_set:Nn \l__SEcover_box_count_int { 1 }
  \setcounter{page}{0}
  \thispagestyle{empty}
  \newpage
  \mbox{}
  \vspace{80pt}
  \begin{center}
    \begin{minipage}{ \l__SEcover_cover_width_dim }
      \parbox[b] { \linewidth }
        {
          \l__SEcover_default_label_format_tl \fontsize{24pt}{24pt} \selectfont
          \centering \leavevmode \@title
        }
      \vspace{123pt}\\
      \hbox to \linewidth
        {
          \begin{minipage}{\linewidth}
            \hbadness=10000
            \fontsize
              { \l__SEcover_default_label_font_size_dim }
              { \l__SEcover_default_line_spacing_dim }
            \linespread{2.2}\selectfont\leavevmode
            \seq_use:Nn \l__SEcover_cover_info_seq { \hfill }
            \hfill
            \parbox[b]{190pt}{\mbox{}}
            \hbadness=1000 
          \end{minipage}
        }
    \end{minipage}
  \end{center}
  \let\makecover\relax
  \newpage
}
